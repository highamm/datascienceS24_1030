---
title: "Section 12: lubridate"
author: "Matt Higham"
format: 
  html:
    embed-resources: true
---

## Class Exercises

Class Exercises 1 and 2.

```{r}
library(tidyverse)
library(lubridate)
library(here)
ds_df <- read_csv(here("data/ds_google.csv"))
ds_df <- ds_df |> mutate(date_var = ym(Month))
ggplot(data = ds_df, aes(x = date_var, y = Data_Science)) +
  geom_line() +
  geom_smooth(se = FALSE) +
  theme_minimal()
```

## Class Exercise 3. Make a plot of gamestop stock price through time.

```{r}
library(tidyquant)
library(tidyverse)
stocks_long <- tq_get(c("AAPL", "CMG", "NTDOY", "SPY", "GME"), get = "stock.prices")

stocks_gme <- stocks_long |> filter(symbol == "GME")
ggplot(data = stocks_gme, aes(x = date, y = close)) +
  geom_line() +
  theme_minimal()
```

Class Exercise 4.

```{r}
stocks_chipotle <- stocks_long |> filter(symbol == "CMG")
stocks_chipotle <- stocks_chipotle |>
  mutate(price_lag = lag(close)) |>
  relocate(price_lag, close)
stocks_chipotle |> mutate(is_higher = if_else(close > price_lag, true = 1, false = 0)) |>
  relocate(is_higher) |>
  filter(!is.na(is_higher)) |>
  summarise(prop_higher = mean(is_higher))

stocks_chipotle |> mutate(weekday = wday(date, label = TRUE)) |>
  relocate(weekday) |>
  filter(weekday == "Wed") |>
  mutate(price_lag = lag(close)) |>
  mutate(is_higher = if_else(close > price_lag, true = 1, false = 0)) |>
  relocate(is_higher) |>
  filter(!is.na(is_higher)) |>
  summarise(prop_higher = mean(is_higher))

stocks_chipotle |>
  mutate(month = month(date),
         year = year(date)) |>
  relocate(month, year) |>
  group_by(month, year) |>
  slice(1) |>
  ungroup() |>
  arrange(year, month) |>
  mutate(price_lag = lag(close)) |>
  mutate(is_higher = if_else(close > price_lag, true = 1, false = 0)) |>
  relocate(is_higher) |>
  filter(!is.na(is_higher)) |>
  summarise(prop_higher = mean(is_higher))
```

## Your Turns

Your Turns 1 through 3.

```{r}
ac_ss <- read_csv(here("data/videogame_ac_ss.csv"),
                  skip = 3,
                  col_names = c("date_var", "ac_pop", "ss_pop")) 

ac_ss <- ac_ss |> mutate(date_var = ym(date_var))
ac_ss_long <- ac_ss |> pivot_longer(2:3, names_to = "search_term",
                      values_to = "popularity")

ggplot(data = ac_ss_long, aes(x = date_var, y = popularity,
                         colour = search_term)) +
  geom_line() +
  geom_smooth() +
  theme_minimal() +
  scale_colour_viridis_d(option = "C")
```
